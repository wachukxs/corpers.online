<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Log In - Corpers Online</title>

    <link rel="icon" type="image/png" href="assets/images/logo32x32.png" />
    <!-- for-mobile-apps -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="Register on Corper Online and get to safely Buy, Sell, get accomodation and location/route info from Corpers" />
    <script type="application/x-javascript">
        addEventListener("load", function() {
            setTimeout(hideURLbar, 0);
        }, false);

        function hideURLbar() {
            window.scrollTo(0, 1);
        }
    </script>
    <!-- //for-mobile-apps -->

    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <!-- <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
		    crossorigin="anonymous"></script> -->

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js" integrity="sha384-pjaaA8dDz/5BgdFUPX6M/9SUZv4d12SUPF0axWc+VRZkx5xU3daN+lYb49+Ax+Tl" crossorigin="anonymous"></script>


    <!-- <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
		    crossorigin="anonymous"></script> -->
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

    <!-- <script src="/font-awesome.min.css"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/holder/2.9.4/holder.js" integrity="sha256-crfkMD0BL2TtiwpbIlXF/SVmGSvOtgbMM8GBkibVKyc=" crossorigin="anonymous"></script>


    <script src="/socket.io/socket.io.js" crossorigin="anonymous"></script>
    <style>
        html {
            height: 100%;
        }

        body {
            min-height: 100%;
            display: grid;
            grid: auto / 1em 1fr 1em;
        }

        .t {
            grid-column: 2 / 3;
        }

        .f {
            grid-column: 1 / -1;
            margin-top: auto;
        }
    </style>
    <script async defer data-website-id="58dce5f5-c238-4e98-b2c6-e701c258f01d" src="https://using-umami.herokuapp.com/umami.js"></script>
</head>

<body>
    <div class="t">
        <div class="h d-flex flex-column flex-md-row align-items-center p-3 px-md-4 bg-white border-bottom box-shadow">
            <h5 class="my-0 mr-md-auto font-weight-normal"><a href="/">Corpers Online</a></h5>
            <nav class="my-2 my-md-0 mr-md-3">
                <a class="p-2 text-dark" href="/contact">Contact</a>
                <a class="p-2 text-dark" href="/about">About</a>
                <a class="p-2 text-dark" href="#!">Log In</a>
                <a class="p-2 text-dark" href="/signup">Sign up</a>
            </nav>

        </div>
        <main role="main">

            <div>
                <div class="jumbotron container bg-white">
                    <h1 class="display-4">Welcome back, Corper!</h1>
                    <p class="lead">We can't wait for you to login in.</p>
                    <hr class="my-4">
                    <p>Ever thought of inviting a fellow corper? <a href="/signup">Or wanna be a Corper Online?</a> </p>

                    <form id="loginform" class="container" action="/login" method="POST" enctype="application/x-www-form-urlencoded">
                        <div class="form-row">
                            <div class="col-md-4 mb-3">
                                <label for="statecode">State code:</label>
                                <input name="statecode" type="text" pattern="(AB|AD|AK|AN|BA|BY|BN|BO|CR|DT|EB|ED|EK|EN|FC|GM|IM|JG|KD|KN|KT|KB|KG|KW|LA|NS|NG|OG|OD|OS|OY|PL|RV|SO|TR|YB|ZM|ab|ad|ak|an|ba|by|bn|bo|cr|dt|eb|ed|ek|en|fc|gm|im|jg|kd|kn|kt|kb|kg|kw|la|ns|ng|og|od|os|oy|pl|rv|so|tr|yb|zm)\/[0-9]{2}[abcACB]\/[0-9]{4}"
                                tabindex="0" class="form-control text-uppercase" autocomplete="statecode" autofocus id="statecode" placeholder="AB/16A/2639" required='true'>
                                <div hidden class="wrong" style="color: red;">

                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="password">Password:</label>
                                <input name="password" type="password" tabindex="0" class="form-control" autocomplete="current-password" id="password" placeholder="Password" required='true'>
                                <div hidden class="wrong" style="color: red;">

                                </div>
                            </div>
                        </div>
                        <!-- 
							<div class="form-group form-check">
								<input type="checkbox" class="form-check-input" id="knowme">
								<label class="form-check-label" for="knowme">Remember me</label>
							</div> 
						-->
                        <input type="submit" class="btn btn-primary" value="Login">
                    </form>
                </div>

            </div>
        </main>
    </div>


    <footer class="f text-center">
        <p>Corpers Online built by <a href="/contact">Corpers</a> for <a href="/login">Corpers</a>.</p>
        <p>
            &copy; <span id="year">2020</span>
        </p>
    </footer>


    <script>
        document.getElementById('year').textContent = new Date().getFullYear();
        // now if the statecode format is correct but they're no longer serving, the
        // error message should be different... saying they must be serving...
        // why does the error message display even after a correct value has been used.
        var years = parseInt(new Date(Date.now()).getFullYear().toFixed().slice(2, 4));
        var yearrange = '(' + (years - 1).toString() + '|' + years.toString() + ')';

        document.forms[0].elements[0].pattern = `^(AB|AD|AK|AN|BA|BY|BN|BO|CR|DT|EB|ED|EK|EN|FC|GM|IM|JG|KD|KN|KT|KB|KG|KW|LA|NS|NG|OG|OD|OS|OY|PL|RV|SO|TR|YB|ZM|ab|ad|ak|an|ba|by|bn|bo|cr|dt|eb|ed|ek|en|fc|gm|im|jg|kd|kn|kt|kb|kg|kw|la|ns|ng|og|od|os|oy|pl|rv|so|tr|yb|zm)\\/${yearrange}[abcACB]\\/\\d\\d\\d\\d$`;

        var sc = new RegExp(`^(ab|ad|ak|an|ba|by|bn|bo|cr|dt|eb|ed|ek|en|fc|gm|im|jg|kd|kn|kt|kb|kg|kw|la|ns|ng|og|od|os|oy|pl|rv|so|tr|yb|zm)\\/${yearrange}[abcACB]\\/[0-9]{4}$`, 'i'); // no 'g'
        var sc001 = new RegExp(`^(ab|ad|ak|an|ba|by|bn|bo|cr|dt|eb|ed|ek|en|fc|gm|im|jg|kd|kn|kt|kb|kg|kw|la|ns|ng|og|od|os|oy|pl|rv|so|tr|yb|zm)\\/[0-9]{2}[abcACB]\\/[0-9]{4}$`, 'ig');
        
        document.forms[0].elements[0].addEventListener("change", function(event) {
            event.target.setCustomValidity("");
            document.getElementsByClassName('wrong')[0].textContent = "";
            let OK = sc.test(event.target.value);
            // console.log(sc, OK);
            if (OK) {

                // console.log(event.target.value + ' is a valid state code!', OK);
                document.getElementById('statecode').classList.remove('is-invalid');
                document.getElementsByClassName('wrong')[0].textContent = "";

            } else {
                let OK001 = sc001.test(event.target.value);
                console.log(sc001, OK001);
                if (OK001) {
                    // you must be currently serving
                    document.getElementById('statecode').classList.add('is-invalid');
                    event.target.setCustomValidity("You must be currently serving");
                } else {
                    // invalid state code
                    document.getElementById('statecode').classList.add('is-invalid');
                    event.target.setCustomValidity("Invalid statecode");
                }
            }
        })
        
        document.forms[0].elements[0].addEventListener("input", function (event) {
            event.target.setCustomValidity("");
        });

        var _sc = new RegExp(`^(ab|ad|ak|an|ba|by|bn|bo|cr|dt|eb|ed|ek|en|fc|gm|im|jg|kd|kn|kt|kb|kg|kw|la|ns|ng|og|od|os|oy|pl|rv|so|tr|yb|zm)\\/[0-9]{2}[abc]\\/[0-9]{4}$`, 'gi');
        document.forms[0].elements[0].oninvalid = function(event) { // fires after submit
            // console.log('evt', event);

            // document.getElementsByClassName('wrong')[0].textContent = "This doens't look like a statecode";
            document.getElementsByClassName('wrong')[0].removeAttribute('hidden');
            document.getElementById('statecode')
                .classList.add('is-invalid');

            var OKK = _sc.test(event.target.value); // OKK[0]
            if (!OKK) { // isn't true... false
                event.target.setCustomValidity("This doens't look like a statecode");
            } else {
                event.target.setCustomValidity("You must be currently serving");
            }
        }

            document.forms[0].elements[1].addEventListener("input", function(event) {
            document.getElementById('password').classList.remove('is-invalid');
            document.getElementsByClassName('wrong')[1].textContent = "";
        })
    </script>
    <script>
        if ('URLSearchParams' in window) {
            var urlParams = new URLSearchParams(window.location.search);
            // URLSearchParams also provides familiar Object methods like keys(), values(), and entries():
            if (urlParams.get('l') === 'n') {
                document.getElementsByClassName('wrong')[0].textContent = "Somthing went wrong. Please try agian.";
                document.getElementsByClassName('wrong')[0].removeAttribute('hidden');
                document.getElementById('statecode')
                    .classList.add('is-invalid');

                
            } else if ( urlParams.get("m") === "s" ) {
                document.getElementById('statecode')
                    .classList.add('is-invalid');
                document.getElementsByClassName('wrong')[0].innerHTML = "State code don't exist. Check again or <a href='/signup'>sign up?</a>";
                document.getElementsByClassName('wrong')[0].removeAttribute('hidden');
            } else if ( urlParams.get("p") === "w" ) {
                document.getElementById('password')
                    .classList.add('is-invalid');
                document.getElementsByClassName('wrong')[1].textContent = "Wrong password";
                document.getElementsByClassName('wrong')[1].removeAttribute('hidden');
            }
        } else { // While URLSearchParams is ideal, not all browsers support that API.
            function getUrlParameter(name) {
                name = name.replace(/[\[]/, '\\[')
                    .replace(/[\]]/, '\\]');
                var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
                var results = regex.exec(location.search);
                return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
            };
            if (getUrlParameter('l') && (getUrlParameter('l') == 'n')) {
                document.getElementsByClassName('wrong')[0].textContent = "Wrong statecode";
                document.getElementsByClassName('wrong')[0].removeAttribute('hidden');
                document.getElementById('statecode')
                    .classList.add('is-invalid');

                document.getElementById('password')
                    .classList.add('is-invalid');
                document.getElementsByClassName('wrong')[1].textContent = "or wrong password";
                document.getElementsByClassName('wrong')[1].removeAttribute('hidden');
            }
        }
    </script>
</body>

</html>

<!--
	https://www.regextester.com
	Top Regular Expressions
	Cheat Sheet
	Character classes


	.							any character except newline
	\w \d \s			word, digit, whitespace
	\W \D \S			not word, digit, whitespace
	[abc]					any of a, b, or c
	[^abc]				not a, b, or c
	[a-g]					character between a & g

	Anchors


	^abc$					start / end of the string
	\b						word boundary

	Escaped characters


	\. \* \\			escaped special characters
	\t \n \r			tab, linefeed, carriage return
	\u00A9				unicode escaped ©

	Groups & Lookaround


	(abc)					capture group
	\1						backreference to group #1
	(?:abc)				non-capturing group
	(?=abc)				positive lookahead
	(?!abc)				negative lookahead

	Quantifiers & Alternation

	a* a+ a?			0 or more, 1 or more, 0 or 1
	a{5} a{2,}		exactly five, two or more
	a{1,3}				between one & three
	a+? a{2,}?		match as few as possible
	ab|cd	match 	ab or cd

-->
<!--


												<script>
					var form1 = document.forms.namedItem("login-form");
					form1.addEventListener('submit', function(ev) {

						//var oOutput = document.querySelector("div")
						oData1 = new FormData(form1);

						//oData.append("CustomField", "This is some extra data");

						var oReq1 = new XMLHttpRequest();
						oReq1.open("POST", "phps/login.php", true);
						oReq1.onload = function(oEvent) {
						if (oReq1.status == 200) {
							//oOutput.innerHTML = "Uploaded!";
							alert("Done!");
						} else {
							//oOutput.innerHTML = "Error " + oReq.status + " occurred when trying to upload your file.<br \/>";
							alert("Error " + oReq1.status + " occurred. \n\nPlease Try It Again");
						}
						};

						oReq1.send(oData1);
						ev.preventDefault();
					}, false);
	</script>
-->